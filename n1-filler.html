<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N1 Filler Demo</title>
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
</head>
<body style="font-family: system-ui; margin: 2rem;">
  <h1>Ontario N1 Form Filler (Simple Demo)</h1>

  <h2>Time to increase the rent on your property? </h2> 
    <p>Answer these simple questions to download your filled out <strong>N1 Form</strong> as a PDF that's ready to send to your tenant:</p>
    <p>2.</p>
  
    <label for="tenantAddress">Tenant's name (as it appears on your lease) and address:</label>
    <textarea id="tenantAddress" rows="3" placeholder="Christine Smith&#10;4-123 Maple St.&#10;Toronto ON M4M 4M4" style="width:300px;"></textarea>
    <br><br>
  
    <label for="landlordAddress">What is the name(s) and address(es) of the landlord(s) of this property, as named on the lease?</label>
    <textarea id="landlordAddress" rows="3" placeholder="John Black&#10;456 Elm Rd.&#10;Toronto ON M4M 4M4" style="width:300px;"></textarea>
    <br><br>
  
    <label for="unitAddress">What is the address this property, as named on the lease? <i>*Include the correct unit number.</i></label>
    <textarea id="unitAddress" rows="3" placeholder="4-123 Maple St.&#10;Toronto ON M4M 4M4" style="width:300px;"></textarea>
    <br><br>

  
  <label for="tenantRent">New Monthly Rent:</label>
    $<input id="tenantRent" type="text" placeholder="1200.00" />
  <br><br>

  <label for="dateEffective">Date the new monthly rent starts:</label>
    <input id="dateEffective" type="date" />
  <br><br>

<fieldset style="margin-top:1.5rem;">
  <legend>Payment Frequency:</legend>

  <label>
    <input type="radio" name="rentFrequency" value="Monthly" checked>
    Monthly
  </label><br>

  <label>
    <input type="radio" name="rentFrequency" value="Weekly">
    Weekly
  </label><br>

  <label>
    <input type="radio" name="rentFrequency" value="Other">
    Other (specify):
  </label>
  <input id="rentFrequencyOther" type="text" placeholder="e.g., biweekly" style="margin-left:5px;" disabled>
</fieldset>


<fieldset style="margin-top:1.5rem;">
  <legend>Rent Increase compared to guidelines:</legend>

  <label>
    <input type="radio" name="rentGuidelines" value="less_or_equal" checked>
    Less than or equal to Guidelines
  </label><br>

  <label>
    <input type="radio" name="rentGuidelines" value="more_than">
    More than the Guidelines
  </label>
    <label><input id="rentApproved" type="radio" name="approvedOrApplied" value="rent_approved" disabled>Approved.</label>
    <label><input id="rentApplied" type="radio" name="approvedOrApplied" value="rent_applied_for" disabled>Applied for.</label>


</fieldset>




  <button id="fillBtn">Download Filled PDF</button>
  <button id="clearBtn" type="button">Clear All Fields</button>












  


<script>
// --- JAVASCRIPT STARTS HERE ---
// --- JAVASCRIPT STARTS HERE ---
// --- JAVASCRIPT STARTS HERE ---
// --- JAVASCRIPT STARTS HERE ---
// --- JAVASCRIPT STARTS HERE ---
// --- JAVASCRIPT STARTS HERE ---

  document.addEventListener("DOMContentLoaded", () => {
  const PDF_URL = "./n1_form_ltbreeze.pdf";

  const radios = document.querySelectorAll('input[name="rentFrequency"]');
  const otherInput = document.getElementById("rentFrequencyOther");

const rentGuidelineRadios = document.querySelectorAll('input[name="rentGuidelines"]');
const approvedRadios = document.querySelectorAll('input[name="approvedOrApplied"]');

rentGuidelineRadios.forEach(radio => {
  radio.addEventListener("change", () => {
    if (radio.value === "more_than" && radio.checked) {
      approvedRadios.forEach(r => (r.disabled = false));
    } else {
      approvedRadios.forEach(r => {
        r.disabled = true;
        r.checked = false;
      });
    }
  });
});


  // Handle enabling/disabling the "Other" text field
  radios.forEach(radio => {
    radio.addEventListener("change", () => {
      if (radio.value === "Other" && radio.checked) {
        otherInput.disabled = false;
        otherInput.focus();
      } else {
        otherInput.disabled = true;
        otherInput.value = "";
      }
    });
  });


// --- Handle "more than guidelines" sub-options ---
const guidelineRadios = document.querySelectorAll('input[name="rentGuidelines"]');
const subRadios = document.querySelectorAll('input[name="approvedOrApplied"]');

guidelineRadios.forEach(radio => {
  radio.addEventListener("change", () => {
    const isMoreThan = radio.value === "more_than" && radio.checked;
    subRadios.forEach(sub => {
      sub.disabled = !isMoreThan;
      if (!isMoreThan) sub.checked = false;
    });
  });
});





  document.getElementById("fillBtn").addEventListener("click", async () => {
  try {
    const addressLandlord = document.getElementById("landlordAddress").value || "—";
    const addressTenant = document.getElementById("tenantAddress").value || "—";
    const addressUnit = document.getElementById("unitAddress").value || "—";
    const rent = document.getElementById("tenantRent").value || "—";

    const existingPdfBytes = await fetch(PDF_URL).then(r => r.arrayBuffer());
    const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
    const form = pdfDoc.getForm();

      const safeSet = (fieldName, value) => {
        try {
          form.getTextField(fieldName).setText(value || "");
        } catch (e) {
          console.warn(`Skipping missing field: ${fieldName}`);
        }
      };

    
    const rawDate = document.getElementById("dateEffective").value;
    const date = rawDate
      ? (() => { const [y, m, d] = rawDate.split("-"); return `${d} ${m} ${y}`; })()
      : "";

    let rentFrequency = "";
    try {
    const rentFrequency = document.querySelector('input[name="rentFrequency"]:checked').value;
    const rentFreqGroup = form.getRadioGroup("rent_frequency");
    rentFreqGroup.select(rentFrequency);
    } catch (e) {
      console.warn("Rent frequency group missing or failed to select");
    }
    
   try {
     const rentGuidelines = document.querySelector('input[name="rentGuidelines"]:checked').value;
    const rentGuideGroup = form.getRadioGroup("rent_guidelines");
    rentGuideGroup.select(rentGuidelines);
    
     const approvedOrApplied = document.querySelector('input[name="approvedOrApplied"]:checked')?.value;
    if (rentGuidelines === "more_than" && approvedOrApplied) {
      const rentApprovedApplied = form.getRadioGroup("approved_or_applied");
      rentApprovedApplied.select(approvedOrApplied);
    }
   } catch (e) {
     console.warn("Guideline or approval group missing");
   }


    if (rentFrequency === "Other") {
      form.getTextField("rent_frequency_other").setText(otherInput.value || "");
    }

      safeSet("n1_landlord_name_and_address", addressLandlord);
      safeSet("n1_tenant_name_and_address", addressTenant);
      safeSet("n1_rental_unit_address", addressUnit);
      safeSet("test_tenant_rent", rent);
      safeSet("n1_new_rent_effective_date", date);

          const rentFrequency = document.querySelector('input[name="rentFrequency"]:checked').value;
      if (rentFrequency === "Other") {
        safeSet("rent_frequency_other", document.getElementById("rentFrequencyOther").value || "");
      }
    
    const filledBytes = await pdfDoc.save();
    const blob = new Blob([filledBytes], { type: "application/pdf" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "n1_filled.pdf";
    a.click();
    } catch (err) {
      console.error("Unexpected error during fill:", err);

      const existingPdfBytes = await fetch(PDF_URL).then(r => r.arrayBuffer());
      const blob = new Blob([existingPdfBytes], { type: "application/pdf" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "n1_partial_or_blank.pdf";
      a.click();
    }
});



  });
</script>



 <script>
// --- Simple local save/restore system (fixed and complete) ---

const fieldIDs = ["landlordAddress", "tenantAddress", "unitAddress", "tenantRent", "dateEffective"];

// restore saved values when page loads
window.addEventListener("load", () => {
  // Restore text fields
  fieldIDs.forEach(id => {
    const el = document.getElementById(id);
    const saved = localStorage.getItem(id);
    if (el && saved !== null) el.value = saved;
  });

  // Restore radio selection
  const savedRadio = localStorage.getItem("rentFrequency");
  if (savedRadio) {
    const radioToCheck = document.querySelector(`input[name="rentFrequency"][value="${savedRadio}"]`);
    if (radioToCheck) {
      radioToCheck.checked = true;
      if (savedRadio === "Other") {
        document.getElementById("rentFrequencyOther").disabled = false;
      }
    }
  }

  // Restore "Other" text if applicable
  const savedOther = localStorage.getItem("rentFrequencyOther");
  if (savedOther !== null) {
    const otherInput = document.getElementById("rentFrequencyOther");
    otherInput.value = savedOther;
  }
});

// Save whenever a text field changes
fieldIDs.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  el.addEventListener("input", () => {
    localStorage.setItem(id, el.value);
  });
});

// Save radio selection
const radios = document.querySelectorAll('input[name="rentFrequency"]');
radios.forEach(radio => {
  radio.addEventListener("change", () => {
    localStorage.setItem("rentFrequency", radio.value);

    // Handle "Other" enabling
    const otherInput = document.getElementById("rentFrequencyOther");
    if (radio.value === "Other" && radio.checked) {
      otherInput.disabled = false;
    } else {
      otherInput.disabled = true;
      otherInput.value = "";
      localStorage.removeItem("rentFrequencyOther");
    }
  });
});



// Save "Other" input
document.getElementById("rentFrequencyOther").addEventListener("input", e => {
  localStorage.setItem("rentFrequencyOther", e.target.value);
});

// Clear button: wipe everything clean
document.getElementById("clearBtn").addEventListener("click", () => {
  const confirmClear = confirm("Are you sure you want to clear all fields and delete saved data?");
  if (!confirmClear) return;

  // Clear text fields
  fieldIDs.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = "";
    localStorage.removeItem(id);
  });

  // Clear radio selections
  radios.forEach(r => (r.checked = false));
  localStorage.removeItem("rentFrequency");

  // Clear "Other"
  const otherInput = document.getElementById("rentFrequencyOther");
  otherInput.value = "";
  otherInput.disabled = true;
  localStorage.removeItem("rentFrequencyOther");

  alert("Clearing all fields! :)");
});
</script>



</body>
</html>
